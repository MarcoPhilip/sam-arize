{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Dashboard</h2>

<h3>Welcome {{user.username}}</h3>

<!-- KPI cards -->
<div class="row g-3 mb-4">
  <div class="col-6 col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Total Assets</div>
        <div class="display-6 fw-bold">{{ kpi.assets }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Suppliers</div>
        <div class="display-6 fw-bold">{{ kpi.suppliers }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Open POs</div>
        <div class="display-6 fw-bold">{{ kpi.pos_open }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <div class="text-muted small">Delivered POs</div>
        <div class="display-6 fw-bold text-success">{{ kpi.pos_delivered }}</div>
      </div>
    </div>
  </div>
</div>



<!-- Tables -->
<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Recent Purchase Orders</div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light"><tr><th>PO #</th><th>Supplier</th><th>Date</th><th>Status</th></tr></thead>
          <tbody>
            {% for po in recent_pos %}
            <tr>
              <td class="fw-semibold"><a href="{% url 'purchase_order_detail' po.pk %}">PO-{{ po.pk }}</a></td>
              <td>{{ po.supplier.name }}</td>
              <td>{{ po.order_date|date:"M d, Y" }}</td>
              <td>
                <span class="badge
                  {% if po.status == 'pending' %} bg-warning text-dark
                  {% elif po.status == 'confirmed' %} bg-info text-dark
                  {% elif po.status == 'shipped' %} bg-primary
                  {% elif po.status == 'delivered' %} bg-success
                  {% else %} bg-secondary{% endif %}">
                  {{ po.get_status_display }}
                </span>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="text-center text-muted py-4">No recent POs.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Low Stock Items</div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light"><tr><th>Item</th><th>Qty</th><th>Category</th></tr></thead>
          <tbody>
            {% for it in low_stock %}
            <tr>
              <td>{{ it.name }}</td>
              <td class="fw-semibold">{{ it.quantity }}</td>
              <td>{{ it.category.name }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-center text-muted py-4">No low stock alerts.</td></tr>
            {% endfor %}
</tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock %}
