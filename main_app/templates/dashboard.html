{% extends 'base.html' %}
{% load static %}

{% block title %}
DASHBOARD Â· SAM-ARIZE
{% endblock %}
{% block head %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<link
  rel="stylesheet"
  href="{% static 'css/home/dashboard.css' %}?v=1.0"
/>
{% endblock %}

{% block content %}


<br>
<br>
 <div class="dashboard-header">
  <h2>Dashboard</h2>
  <h3>Welcome, {{ user.username }}ðŸŽ‰</h3>


<div class="dashboard-container">
<br>


<!-- KPI cards -->
<div class="row g-3 mb-4">
  <!-- Total Assets -->
  <div class="col-6 col-md-3">
    <a href="{% url 'asset_index' %}" class="text-decoration-none">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <i class="bi bi-box-seam fs-4 me-2 i-icon"></i>
            <div>
              <div class="text-muted small">Total Assets</div>
              <div class="display-6 fw-bold">{{ kpi.assets }}</div>
            </div>
          </div>
        </div>
      </div>
    </a>
  </div>
  <!-- Suppliers -->
  <div class="col-6 col-md-3">
    <a href="{% url 'supplier_list' %}" class="text-decoration-none">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <i class="bi bi-people fs-4 me-2 i-icon"></i>
            <div>
              <div class="text-muted small">Suppliers</div>
              <div class="display-6 fw-bold">{{ kpi.suppliers }}</div>
            </div>
          </div>
        </div>
      </div>
    </a>
  </div>
  <!-- Open POs -->
  <div class="col-6 col-md-3">
    <a href="{% url 'purchase_order_list' %}" class="text-decoration-none">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <i class="bi bi-file-earmark-text fs-4 me-2 i-icon"></i>
            <div>
              <div class="text-muted small">Open POs</div>
              <div class="display-6 fw-bold">{{ kpi.pos_open }}</div>
            </div>
          </div>
        </div>
      </div>
    </a>
  </div>
  <!-- Delivered POs -->
  <div class="col-6 col-md-3">
    <a href="{% url 'purchase_order_list' %}?status=delivered" class="text-decoration-none">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <i class="bi bi-truck fs-4 me-2 i-icon"></i>
            <div>
              <div class="text-muted small">Delivered POs</div>
              <div class="display-6 fw-bold text-success">{{ kpi.pos_delivered }}</div>
            </div>
          </div>
        </div>
      </div>
    </a>
  </div>
</div>

<!-- Tables -->
<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Recent Purchase Orders</div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>PO #</th>
              <th>Supplier</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for po in recent_pos %}
            <tr>
              <td class="fw-semibold"><a href="{% url 'purchase_order_detail' po.pk %}">PO-{{ po.pk }}</a></td>
              <td>{{ po.supplier.name }}</td>
              <td>{{ po.order_date|date:"M d, Y" }}</td>
              <td>
                <span class="badge
                  {% if po.status == 'pending' %} bg-warning text-dark
                  {% elif po.status == 'confirmed' %} bg-info text-dark
                  {% elif po.status == 'shipped' %} bg-primary
                  {% elif po.status == 'delivered' %} bg-success
                  {% else %} bg-secondary{% endif %}">
                  {{ po.get_status_display }}
                </span>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted py-4">No recent POs.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-white fw-semibold">Low Stock Items</div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Item</th>
              <th>Qty</th>
              <th>Category</th>
            </tr>
          </thead>
          <tbody>
            {% for it in low_stock %}
            <tr>
              <td>{{ it.name }}</td>
              <td class="fw-semibold">{{ it.quantity }}</td>
              <td>{{ it.category.name }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="3" class="text-center text-muted py-4">No low stock alerts.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<br> 

<div class="col-6 col-md-3">
  <div class="card shadow-sm h-100">
    <div class="card-body">
      <div class="d-flex align-items-center">
        <i class="bi bi-graph-up fs-4 me-2 i-icon"></i>
        <div>
          <div class="text-muted small">Monthly PO Target</div>
          <div class="display-6 fw-bold">75%</div>
          <div class="progress mt-2" style="height: 6px;">
            <div class="progress-bar bg-orange" role="progressbar" style="width: 75%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<br>

<div class="col-12 col-md-4">
  <div class="card shadow-sm h-100">
    <div class="card-header bg-white fw-semibold">Top Suppliers</div>
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Supplier</th>
            <th>On-Time %</th>
            <th>Quality</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Supplier A</td>
            <td><div class="progress" style="height: 6px;"><div class="progress-bar bg-success" style="width: 95%"></div></td>
            <td><i class="bi bi-star-fill text-warning"></i> 4.8</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
</div>

{% endblock %}
